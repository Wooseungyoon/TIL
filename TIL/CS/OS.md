## 운영체제(OS)

### 1. 프로세스 vs 스레드

#### 프로세스

```javascript
프로세스(Process)란
- 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램
- 메모리에 올라와 실행되고 있는 프로그램의 인스턴스(독립적인 개체)
  독립된 메모리 영역(Code,Data,Stack,Heap)
- 운영체제로부터 시스템 자원을 할당받는 작업의 단위
- 동적인 개념으로는 "실행된 프로그램"을 의미
```

-----------------------------------------------------------------------------------------------------------------------------------------------------------

​																          	**0peration System**

| process | process | process |
| :-----: | :-----: | :-----: |
|  code   |  code   |  code   |
|  data   |  data   |  data   |
|  stack  |  stack  |  stack  |
|  heap   |  heap   |  heap   |

-----------------------------------------------------------------------------------------------------------------------------------------------------------

```
위와 같이 OS 내에는 독립적인 여러개의 프로세스가 동작할 수 있다.

- 프로세스는 각각 독립된 메모리 영역(code,data,stack,heap)을 할당받는다.
- 기본적으로 프로세스당 최소 1개의 스레드(메인스레드)를 가지고 있다.
- 각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없다.
- 한 프로세스가 다른 프로세스 자원에 접근하려면 프로세스간의 통신(IPC , inter-process communication)을 사용해야한다.
```

#### 스레드

```
- 프로세스 내에서 실행되는 여러 흐름의 단위
- 프로세스의 특정한 수행경로
- 프로세스가 할당받은 자원을 이용하는 실행의 단위

```

-----------------------------------------------------------------------------------------------------------------------------------------------------------

​																					**Process**

​                                 **Code                                            Data                                            Heap**

| Thread1 | Thread2 |
| :-----: | :-----: |
|  stack  |  stack  |

-----------------------------------------------------------------------------------------------------------------------------------------------------------



````javascript
- 스레드는 프로세스내에서 Stack만 따로 할당 받고 code,data,heap 영역은 공유한다.
- 스레드는 한 프로세스 내에서 동작되는 여러 실행의 흐름
  => 프로세스 내의 주소공간이나 자원들(힙 공간 등)을 같은 프로세스 내의 스레드끼리 공유하며 실행된다.

- 같은 프로세스 안에 있는 여러 스레드는 "힙 공간을 공유"한다.
- 각각의 스레드는 별도의 레지스터와 스택을 갖고 있지만, 힙 메모리는 서로 읽고 쓸 수 있다.

  => 한 스레드가 프로세스 자원을 변경하면 다른 이웃 스레드도 그 변경 결과를 즉시 볼 수 있다.
````

### 2. 자바 스레드

```javascript
- 일반 스레드와 거의 차이가 없으며, JVM이 운영체제의 역할을 한다.
- 자바에는 프로세스가 존재하지 않고 스레드만 존재하며, 자바 스레드는 JVM에 의해 스케줄되는
  "실행 단위 코드 블록"이다.
- 자바에서 스레드 스케줄링은 전적으로 JVM에 의해 이루어진다.

* JVM이 알고 있는 스레드 정보
- 스레드 개수
- 스레드가 몇 개 존재하는지
- 스레드로 실행되는 프로그램 코드의 메모리 위치는 어디인지
- 스레드의 상태는 무엇인지
- 스레드 우선순위는 얼마인지

즉, 개발자는 자바 스레드로 동작할 스레드를 작성하고, 스레드 코드가 실행되도록 JVM에 요청하는 일을 한다.
```

### 3. 멀티 프로세스 vs 멀티 스레드

#### 멀티 프로세스

```java
- 하나의 응용프로그램을 "여러 개의 프로세스"로 구성하여 각 프로세스가 "하나의 작업을 처리"하도록 하는 것.
  
장점    
- 여러 개의 자식 프로세스 중 하나에 문제가 발생하면 그 자식 프로세스만 죽는 것 이상으로 다른 영향이 없다.
    
단점
- Context Switching에서의 오버헤드
   * Context Switching 과정에서 캐쉬 메모리 초기화 등 무거운 작업이 진행되고 많은 시간이 소모되는 등의
    오버헤드가 발생한다.
    
   * 프로세스는 각각의 "독립된 메모리 영역"을 할당받았기에 프로세스 사이에서 "공유하는 메모리가 없어"	
    Context Switching이 발생하면 캐쉬에 있는 모든 데이터를 모두 리셋하고, 다시 캐쉬 정보를 불러와야한		다.
    
- 프로세스 사이의 어렵고 복잡한 통신기법(IPC)
    프로세스는 독립적이기에 프로세스 간 메모리를 공유할 수 없다.
    
    
Context Switching ?
    
   - CPU에서 여러 프로세스가 돌아가면서 작업을 처리하는데 이 과정을 Context Switching이라 한다.
   - 빠른 속도로 Task를 바꿔가며 실행하기 때문에 사람의 눈으로 볼때는 실시간처럼 보이게 된다.
   - 동작 중인 프로세스가 대기할 때 해당 프로세스의 상태(Context)를 보관하고,
	다음 진행할 프로세스의 상태 값을 읽어 적용하는 과정이다.
```

#### 멀티스레드

```
- 하나의 응용프로그램을 여럭 개의 스레드로 구성하고 각 스레드로 하여금 하나의 작업을 처리하도록 하는 것
- 윈도우, 리눅스 등 여러 운영체제들이 멀티 프로세싱을 지원하지만 멀티 스레딩을 기본으로 한다.
- 웹 서버는 대표적인 멀티 스레드 응용프로그램이다.

장점
 - 시스템 자원 소모 감소
   * 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다.
 - 시스템 처리량 증가
   * 스레드 사이의 작업량이 작아 Context Switching이 빠르다.
   * 스레드간 데이터를 주고 받는 것이 간단해지고,시스템 자원소모가 줄어든다.
 - 간단한 통신 방법으로 인한 프로그램 응답시간 단축	
   * 전역변수 혹은 동적할당 공간인 힙영역을 이용해 데이터를 주고 받을 수 있다.
   
단점
 - 멀티쓰레딩 환경에선 동기화 작업이 필요하다.
 - 서로 다른 스레드가 데이터와 힙영역을 공유하기에 어떤 스레드가 사용중인 변수나 자료구조에 접근해
  엉뚱한 값을 읽어오거나 수정할 수 있다.
  
  
 멀티스레드 예시)
 경마 프로그램
   
```

#### 왜 멀티프로세스보다 멀티 스레드인가?

```
간단한 예시로 설명하자면 멀티프로세스는 문서작업을 할 때 여러개의 문서 프로그램을 켜두는 것이고, 멀티 스레드는 문서 프로그램내에서 새로운 문서창을 띄우는 것으로 이해 할 수 있다. 
따라서 운영체제가 받는 부담이 확 줄어들게 된다.

1) 자원의 효율
 여러 프로세스를 할당하는 등의 시스템 콜(커널영역의 기능을 사용자 영역에서 사용가능하게 하는 작업)이 줄어든다.
 
2) 처리비용, 응답시간 단축
 스레드간 통신은 stack을 제외한 모든 메모리를 공유하기 때문에 프로세스간 통신보다 훨씬 비용이 적게 소모된다. (* 프로세스 통신은 IPC가 필요하다)

```

